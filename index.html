<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Agente Vegas â€” Interface</title>
  <style>
    :root{--overlay-bg: rgba(0,0,0,0.45);--card-bg: rgba(255,255,255,0.06)}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    /* Video fullscreen */
    .bg-video{position:fixed;inset:0;z-index:0;object-fit:cover;width:100%;height:100%}

    /* Top logo */
    .logo{position:fixed;top:16px;left:50%;transform:translateX(-50%);z-index:3;max-height:80px;pointer-events:none}

    /* Controls overlay */
    .controls{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;z-index:4;width:min(980px,94%);display:grid;grid-template-columns:1fr 120px;gap:12px;padding:14px;border-radius:12px;background:var(--overlay-bg);backdrop-filter:blur(6px);box-shadow:0 6px 20px rgba(0,0,0,0.5)}

    .panel{background:transparent;padding:8px;display:flex;flex-direction:column;gap:8px}

    .input-row{display:flex;gap:8px}
    input[type="text"]{flex:1;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);background:rgba(255,255,255,0.03);color:#fff;font-size:16px}
    button{padding:10px 12px;border-radius:10px;border:0;background:#111;color:#fff;cursor:pointer}
    .mic-btn{display:inline-grid;place-items:center;width:52px;height:52px;border-radius:999px;background:linear-gradient(180deg,#e53935,#c62828);box-shadow:0 6px 20px rgba(197,36,36,0.25)}

    .answer-box{max-height:260px;overflow:auto;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(0,0,0,0.3);color:#fff}

    .small{font-size:13px;color:rgba(255,255,255,0.7)}

    /* Responsive */
    @media (max-width:700px){.controls{grid-template-columns:1fr;gap:10px;padding:12px}}
  </style>
</head>
<body>
  <!-- Background video and logo (use the files in same folder: Vegon1.mp4 and logovegas.jpeg) -->
  <video class="bg-video" id="bgVideo" autoplay muted loop playsinline>
    <source src="Vegon1.mp4" type="video/mp4">
    Seu navegador nÃ£o suporta vÃ­deo.
  </video>

  <img src="logovegas.jpeg" alt="Logo Vegas" class="logo" />

  <!-- Controls overlay -->
  <div class="controls" role="region" aria-label="Controles do agente">
    <div class="panel">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
        <div>
          <div class="small">Pergunta (fale ou digite)</div>
          <div class="input-row" style="margin-top:6px">
            <input id="questionInput" type="text" placeholder="Escreva sua pergunta aqui..." aria-label="Campo de pergunta">
            <button id="askBtn">Perguntar</button>
          </div>
        </div>

        <div style="display:flex;flex-direction:column;align-items:center;gap:8px">
          <button id="micToggle" class="mic-btn" title="Pressione para gravar/pausar" aria-pressed="false">ðŸŽ¤</button>
          <div class="small">Pressione para ouvir (gravar)</div>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;margin-top:6px">
        <button id="playQuestion">â–¶ Ouvir pergunta</button>
        <button id="playAnswer">ðŸ”ˆ Ouvir resposta</button>
        <div id="status" class="small" style="margin-left:8px">Pronto.</div>
      </div>
    </div>

    <div class="panel">
      <div class="small">Resposta</div>
      <div id="answerBox" class="answer-box">Aguardando pergunta...</div>
    </div>
  </div>

  <script>
    // --- Tarefas principais: reconhecimento de fala (SpeechRecognition), TTS (speechSynthesis), UI ---

    const questionInput = document.getElementById('questionInput');
    const askBtn = document.getElementById('askBtn');
    const micToggle = document.getElementById('micToggle');
    const status = document.getElementById('status');
    const answerBox = document.getElementById('answerBox');
    const playQuestion = document.getElementById('playQuestion');
    const playAnswer = document.getElementById('playAnswer');

    // Speech Recognition (SÃ³ funciona em navegadores com suporte â€” Chrome/Edge sobre HTTPS ou localhost)
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    let recognition;
    let listening = false;

    if (SpeechRecognition) {
      recognition = new SpeechRecognition();
      recognition.lang = 'pt-BR';
      recognition.interimResults = true;
      recognition.maxAlternatives = 1;

      recognition.addEventListener('start', () => {
        listening = true; micToggle.setAttribute('aria-pressed','true'); status.textContent = 'Ouvindo...';
      });
      recognition.addEventListener('end', () => {
        listening = false; micToggle.setAttribute('aria-pressed','false'); status.textContent = 'Pronto.';
      });

      recognition.addEventListener('result', (ev) => {
        // mostra resultado intermediÃ¡rio e final
        let interim = '';
        let finalTranscript = '';
        for (let i=ev.resultIndex;i<ev.results.length;i++){
          const r = ev.results[i];
          if (r.isFinal) finalTranscript += r[0].transcript;
          else interim += r[0].transcript;
        }
        questionInput.value = finalTranscript || interim || questionInput.value;

        // auto-enviar quando houver final
        if (finalTranscript.trim()) {
          // pequena pausa para garantir que o usuÃ¡rio tenha terminado
          setTimeout(()=> submitQuestion(finalTranscript.trim()), 150);
        }
      });

      recognition.addEventListener('error', (e)=>{
        console.warn('SpeechRecognition error', e);
        status.textContent = 'Erro no reconhecimento: ' + (e.error || e.message);
      });
    } else {
      micToggle.disabled = true;
      micToggle.title = 'Reconhecimento de voz nÃ£o suportado neste navegador';
      status.textContent = 'Reconhecimento de voz nÃ£o suportado.';
    }

    micToggle.addEventListener('click', ()=>{
      if (!recognition) return;
      if (!listening) {
        try { recognition.start(); } catch(e){ console.warn(e); }
      } else {
        recognition.stop();
      }
    });

    askBtn.addEventListener('click', ()=> submitQuestion(questionInput.value.trim()));

    // Texto-para-fala (TTS)
    function speak(text){
      if (!window.speechSynthesis) { alert('TTS nÃ£o suportado'); return; }
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = 'pt-BR';
      u.rate = 1;
      window.speechSynthesis.speak(u);
    }

    playQuestion.addEventListener('click', ()=>{
      const t = questionInput.value.trim();
      if (!t) { status.textContent = 'Nada para ouvir.'; return; }
      speak(t);
    });
    playAnswer.addEventListener('click', ()=>{
      const t = answerBox.textContent.trim();
      if (!t) { status.textContent = 'Sem resposta para ouvir.'; return; }
      speak(t);
    });

    // FunÃ§Ã£o que solicita resposta ao "agente" â€” por ora mock, troque por fetch('/api/ask', {...})
    async function getAnswer(question){
      // Exemplo de integraÃ§Ã£o com backend:
      // return fetch('/api/ask', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({question})}).then(r=>r.json()).then(j=>j.answer)

      // Mock simples para desenvolvimento local:
      await new Promise(r=>setTimeout(r, 500));
      return 'Resposta simulada para: "' + question + '"\n\n(Substitua getAnswer() por uma chamada Ã  sua API para obter respostas reais.)';
    }

    async function submitQuestion(q){
      if (!q) { status.textContent = 'Digite ou fale uma pergunta primeiro.'; return; }
      status.textContent = 'Processando...';
      answerBox.textContent = 'Buscando resposta para: ' + q;
      try {
        const ans = await getAnswer(q);
        answerBox.textContent = ans;
        status.textContent = 'Resposta recebida.';
        // opcional: ler a resposta automaticamente
        // speak(ans);
      } catch(e){
        console.error(e);
        answerBox.textContent = 'Erro ao obter resposta.';
        status.textContent = 'Erro.';
      }
    }

    // BotÃ£o para pausar/retomar vÃ­deo (opcional UX)
    document.getElementById('bgVideo').addEventListener('click', ()=>{
      const v = document.getElementById('bgVideo');
      if (v.paused) v.play(); else v.pause();
    });

    // Pequena melhoria visual: garante contraste do vÃ­deo (opcional)
    // VocÃª pode ajustar a opacidade do vÃ­deo para deixar os textos mais legÃ­veis
    document.getElementById('bgVideo').style.filter = 'brightness(0.6) contrast(1.02)';
  </script>
</body>
</html>
