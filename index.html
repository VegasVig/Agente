<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Agente Vegas ‚Äî Interface</title>
    <style>
        :root{--overlay-bg: rgba(0,0,0,0.45);--card-bg: rgba(255,255,255,0.06)}
        html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;color:#fff}
        .bg-video{position:fixed;inset:0;z-index:0;object-fit:cover;width:100%;height:100%}
        .logo{position:fixed;top:16px;left:50%;transform:translateX(-50%);z-index:3;max-height:80px;pointer-events:none}
        .controls{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;z-index:4;width:min(980px,94%);
            display:grid;grid-template-columns:1fr 120px;gap:12px;padding:14px;border-radius:12px;
            background:var(--overlay-bg);backdrop-filter:blur(6px);box-shadow:0 6px 20px rgba(0,0,0,0.5)}
        .panel{background:transparent;padding:8px;display:flex;flex-direction:column;gap:8px}
        .input-row{display:flex;gap:8px;align-items:stretch;} /* Ajustado */
        input[type="text"]{flex:1;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.12);
            background:rgba(255,255,255,0.03);color:#fff;font-size:16px}
        button{padding:10px 12px;border-radius:10px;border:0;background:#111;color:#fff;cursor:pointer;transition:background-color 0.2s}
        button:hover{background:#333}
        .mic-btn{display:inline-grid;place-items:center;width:52px;height:52px;border-radius:999px;
            background:linear-gradient(180deg,#e53935,#c62828);box-shadow:0 6px 20px rgba(197,36,36,0.25)}
        .answer-box{max-height:260px;overflow:auto;padding:12px;border-radius:8px;
            border:1px solid rgba(255,255,255,0.06);background:rgba(0,0,0,0.3);color:#fff}
        .small{font-size:13px;color:rgba(255,255,255,0.7)}
        .pdf-upload-container{margin-top:10px;padding:10px;border:1px dashed rgba(255,255,255,0.3);border-radius:8px;text-align:center;}
        input[type="file"]{display:none;}
        .custom-file-upload{
            border: 1px solid #ccc;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
            background: #222;
            border-radius: 6px;
        }
        #pdfList{text-align:left;max-height:60px;overflow-y:auto;padding-top:5px;font-size:12px;color:#999;}

        @media (max-width:700px){.controls{grid-template-columns:1fr;gap:10px;padding:12px}}
    </style>
</head>
<body>
    <video class="bg-video" id="bgVideo" preload="auto" playsinline loop>
        <source src="./assets/Vegon1.mp4" type="video/mp4">
        Seu navegador n√£o suporta v√≠deo.
    </video>
    <div class="controls">
        <div class="panel">
            <div style="display:flex;align-items:center;justify-content:space-between;gap:12px">
                <div style="flex-grow:1;">
                    <div class="small">Pergunta (fale ou digite)</div>
                    <div class="input-row" style="margin-top:6px">
                        <input id="questionInput" type="text" placeholder="Escreva sua pergunta..." />
                        <button id="askBtn">Perguntar</button>
                    </div>
                </div>
                <div style="display:flex;flex-direction:column;align-items:center;gap:8px">
                    <button id="micToggle" class="mic-btn" title="Pressione para gravar">üé§</button>
                    <div class="small" id="micStatus">Pressione para gravar</div>
                </div>
            </div>

            <div class="pdf-upload-container">
                <div class="small">Documentos para Pesquisa (RAG)</div>
                <label for="pdfUpload" class="custom-file-upload">
                    üì§ Escolher PDF(s)
                </label>
                <input type="file" id="pdfUpload" accept=".pdf" multiple />
                <div id="pdfList">Nenhum PDF selecionado.</div>
            </div>
        </div>

        <div class="panel">
            <div class="small">Resposta</div>
            <div id="answerBox" class="answer-box"></div>
        </div>
    </div>

    <script>
        // 1Ô∏è‚É£ --- Configura√ß√£o do v√≠deo (√Åudio de 6s, Loop Cont√≠nuo) ---
        const bgVideo = document.getElementById('bgVideo');
        const MAX_AUDIO_TIME = 6; // Dura√ß√£o m√°xima do √°udio em segundos

        // Inicializa o √°udio. O 'loop' no HTML garante que ele continue rodando (sem som).
        bgVideo.muted = false;
        bgVideo.loop = true; // Mantemos o loop para o v√≠deo rodar infinitamente

        // L√≥gica para silenciar ap√≥s 6 segundos (se o v√≠deo for mais longo)
        bgVideo.addEventListener('playing', () => {
            // Se o v√≠deo estiver com som e a dura√ß√£o for maior que 6s,
            // silencia ap√≥s o tempo definido.
            if (!bgVideo.muted) {
                setTimeout(() => {
                    if (bgVideo.currentTime < MAX_AUDIO_TIME + 0.5) { // Evita silenciar antes de 6s
                        bgVideo.muted = true;
                        console.log('√Åudio do v√≠deo silenciado ap√≥s 6 segundos.');
                    }
                }, MAX_AUDIO_TIME * 1000);
            }
        });

        // Evento para garantir que o √°udio seja reativado no in√≠cio de cada loop
        // (S√≥ ser√° relevante se o v√≠deo for menor que 6s e o loop ocorrer,
        // mas √© uma boa pr√°tica se a l√≥gica de silenciar falhar/mudar)
        bgVideo.addEventListener('timeupdate', () => {
            // Se o v√≠deo for longo, a l√≥gica do setTimeout deve ser suficiente.
            // Se o v√≠deo for curto (ex: 4s) e for dado loop, o √°udio toca 4s
            // e o muted=true √© aplicado 2s ap√≥s o segundo loop (4s + 2s).
            // A l√≥gica ideal √© mais complexa e depende da dura√ß√£o exata do seu v√≠deo.
            
            // Para garantir que o √°udio toque **apenas uma vez no in√≠cio**,
            // vamos apenas garantir que o v√≠deo esteja silenciado ap√≥s o primeiro "play"
            // Se voc√™ quer que o som toque **toda vez que a p√°gina carrega**,
            // a l√≥gica do setTimeout deve ser suficiente, pois `loop: true` no HTML
            // garante a repeti√ß√£o visual.
        });


        // 2Ô∏è‚É£ --- Reconhecimento de voz (Sem Altera√ß√µes) ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const micToggle = document.getElementById('micToggle');
        const micStatus = document.getElementById('micStatus');
        const questionInput = document.getElementById('questionInput');
        // ... (resto do c√≥digo de SpeechRecognition) ...
        let recognition;
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.lang = 'pt-BR';
            recognition.continuous = false;
            recognition.interimResults = false;

            recognition.onstart = () => {
                micStatus.textContent = 'Ouvindo...';
                micToggle.style.background = 'linear-gradient(180deg,#43a047,#2e7d32)';
            };

            recognition.onresult = (event) => {
                const text = event.results[0][0].transcript;
                questionInput.value = text;
                micStatus.textContent = 'Grava√ß√£o conclu√≠da.';
                submitQuestion(text); // Chama submitQuestion com o texto reconhecido
            };

            recognition.onerror = (e) => {
                console.error('Erro no microfone:', e.error);
                micStatus.textContent = 'Erro no microfone ou permiss√£o negada.';
            };

            recognition.onend = () => {
                micToggle.style.background = 'linear-gradient(180deg,#e53935,#c62828)';
            };

            micToggle.onclick = () => {
                recognition.start();
            };
        } else {
            micToggle.disabled = true;
            micStatus.textContent = 'Reconhecimento de voz n√£o suportado.';
        }
        
        // Fun√ß√£o auxiliar para enviar a pergunta, usada pelo mic e pelo bot√£o
        function submitQuestion(question) {
             const q = question.trim();
             if (!q) return;
             answerBox.textContent = "Pensando...";
             // Chamada da fun√ß√£o de resposta
             getAnswerAndDisplay(q);
        }

        // 3Ô∏è‚É£ --- L√≥gica de Upload de PDF (Simula√ß√£o de Frontend) ---
        const pdfUpload = document.getElementById('pdfUpload');
        const pdfList = document.getElementById('pdfList');
        let uploadedFiles = []; // Array para armazenar os arquivos

        pdfUpload.addEventListener('change', (event) => {
            uploadedFiles = Array.from(event.target.files);
            updatePdfListDisplay();
        });

        function updatePdfListDisplay() {
            if (uploadedFiles.length === 0) {
                pdfList.textContent = "Nenhum PDF selecionado.";
            } else {
                pdfList.innerHTML = 'üìö PDFs Selecionados: ' + uploadedFiles.map(f => `**${f.name}** (${(f.size / 1024).toFixed(1)} KB)`).join(', ');
            }
        }


        // 4Ô∏è‚É£ --- L√≥gica de Envio (Fun√ß√£o getAnswer precisa ser implementada no Backend) ---
        // A fun√ß√£o getAnswer DEVE ser implementada no seu backend para lidar com a RAG.
        // Aqui, estou apenas simulando a chamada.

        /**
         * FUN√á√ÉO CR√çTICA: Simula a chamada ao backend (API) para obter a resposta.
         * Esta fun√ß√£o precisa ser REALMENTE implementada em um servidor (Node.js, Python, etc.)
         * que lida com o RAG (PDF Indexing + LLM).
         * @param {string} question A pergunta do usu√°rio.
         * @returns {Promise<string>} A resposta do Agente.
         */
        async function getAnswer(question) {
            // ‚ö†Ô∏è Substitua esta l√≥gica por uma chamada fetch() real ao seu servidor.
            // Exemplo de como voc√™ enviaria a pergunta E a lista de PDFs:
            
            // const formData = new FormData();
            // formData.append('question', question);
            // uploadedFiles.forEach(file => {
            //     formData.append('pdfFiles', file);
            // });

            // const response = await fetch('SUA_URL_DE_BACKEND/api/ask', {
            //     method: 'POST',
            //     body: formData 
            // });

            // const data = await response.json();
            // return data.answer; 

            // SIMULA√á√ÉO (Remova este bloco ao implementar o Backend real):
            console.log("Pergunta enviada:", question);
            if (uploadedFiles.length > 0) {
                const fileNames = uploadedFiles.map(f => f.name).join(', ');
                await new Promise(r => setTimeout(r, 2000)); // Espera 2s
                return `Baseado nos documentos (${fileNames}), o sistema RAG est√° processando a resposta para: "${question}". (Esta √© uma resposta simulada. Implemente o backend!)`;
            } else {
                 await new Promise(r => setTimeout(r, 1500)); // Espera 1.5s
                 return `Resposta padr√£o: Ol√°! Sou o Agente Vegas. Por favor, especifique o que voc√™ gostaria de saber ou envie um PDF para uma busca aprofundada.`;
            }
            // FIM DA SIMULA√á√ÉO
        }


        // 5Ô∏è‚É£ --- L√≥gica de envio e exibi√ß√£o ---
        const askBtn = document.getElementById('askBtn');
        const answerBox = document.getElementById('answerBox');

        async function getAnswerAndDisplay(q) {
             try {
                 const ans = await getAnswer(q);
                 answerBox.textContent = ans;
                 speak(ans);
             } catch (e) {
                 console.error(e);
                 answerBox.textContent = "Erro ao obter resposta. Verifique o console para detalhes.";
             }
        }

        // Ligar o bot√£o √† fun√ß√£o de envio
        askBtn.onclick = () => submitQuestion(questionInput.value);


        // 6Ô∏è‚É£ --- Fala de resposta (TTS) ---
        function speak(text) {
            const u = new SpeechSynthesisUtterance(text);
            u.lang = "pt-BR";
            u.rate = 1;
            window.speechSynthesis.speak(u);
        }
    </script>
</body>
</html>